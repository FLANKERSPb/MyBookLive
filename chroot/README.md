# Установка chroot-среды

Разрешите в WD My Book Live SSH-сервис, для чего перейдите в WEB-интерфейс устройства, введите пароль владельца и наберите в адресной строке `http://mybooklive/UI/ssh` и отметьте флажком пункт "Доступ SSH".

Подключитесь к SSH-консоли устройства. Воспользуйтесь любым ssh-клиентом, например, [PuTTY] (https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html). В строке Host Name (or IP address) впишите имя своего устройства (если вы его не меняли - mybooklive) или его IP-адрес. Нажмите Open. Имя пользователя - `root`, пароль - `welc0me` (0 - цифра). Пароль вводится вслепую. Если сделали все правильно, появится приглашение к работе

    MyBookLive:~#

Скачайте и запустите скрипт автоустановки chroot-среды, Для чего выполните в консоли последовательно команды:

    MyBookLive:~# wget --no-check-certificate https://github.com/MyBookLive/chroot/raw/master/install.sh
    MyBookLive:~# sh ./install.sh
    
> Подсказка: в PuTTY можно вставлять скопированные в буфер обмена команды правой кн. мыши или сочетанием клавиш Shift+Ins.

Начнётся установка базового набора файлов дистрибутива Debian **Wheezy**, которая может занят от 20 до 40 минут в зависимости от загруженности NAS'а и ширины интернет-канала. После чего будет возможность установить по вашему желанию медиасервер miniDLNA и\или торрент-клиент Transmission. После установки можно (опционально) запустить установленные сервисы без перезагрузки устройства.



Обычно большинству новичков нового DLNA-сервера и торрент клиента достаточно. Если вы не хотите вникать в подробности работы chroot-среды, то на этом можно остановиться: и DLNA-сервер, и торрент клиент будут правильно стартовать при включении NAS'а и грациозно завершать работу при выключении/перезагрузке. Можно выйти из SSH-консоли, набрав exit и забыть про неё.



Но если свежеустановленный полноценный дистрибутив Debian Wheezy — лишь канва для дальнейшего творчества, то ознакомьтесь с базовыми моментами работы среды.


Использование chroot среды


Запуск


Скрипт установки прописывает всё необходимое для запуска выбранных сервисов в сhroot-среде. Сервисы, которые будут стартовать при включении My Book Live перечислены в файле `/DataVolume/debian/chroot-services.list`, по одному сервису в строчке.


Подсказка: в chroot-services.list перечислены имена файлов из `/DataVolume/debian/etc/init.d`, которые необходимо запустить


Даже если никаких сервисов в chroot-среде пока не запускается, перед входом в неё необходимо выполнить скрипт запуска для монтирования необходимых каталогов:

    /etc/init.d/chroot_debian.sh start


Вход и выход из работающей chroot-среды


Выполните

    chroot /DataVolume/debian


Выполнив `ls /` вы поймёте, что уже не в окружении прошивки. Так же изменилось приглашение с `MyBookLive:~#` на `(chroot-debian)~#`. Здесь уже можно без боязни выполнять `apt-get update`, устанавливать, конфигурировать или удалять любые пакеты: перед вами полноценный дистрибутив Debian Stable, который можно использовать практически без ограничений. Из-за того, что всё происходит в изолированной "песочнице", файлам прошивки навредить не выйдет при всём желании. После окончания конфигурирования новых сервисов не забудьте внести их имена в `chroot-services.list`. Для выхода из chroot-среды выполните `exit` и вы вернётесь в привычное окружение прошивки.

    (chroot-debian)~# exit
    MyBookLive:~#


Остановка

    /etc/init.d/chroot_debian.sh stop


Воостановление автостарта после обновления прошивки
Необходимо вернуть на законное место скрипт запуска chroot-сервисов:

    /DataVolume/debian/chroot_debian.sh install
    
    
Удаление chroot-среды

    /etc/init.d/chroot_debian.sh stop
    /etc/init.d/chroot_debian.sh remove

Перегрузите WD My Book Live и удалите все файлы Debian Wheezy

    rm -fr /DataVolume/debian/

