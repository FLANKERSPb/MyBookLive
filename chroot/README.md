# chroot-среда

## Установка chroot-среды

Для установки chroot-среды необходимо в web-интерфейсе устройства разрешить SSH доступ, сделать это можно на странице http://mybooklive/UI/ssh (или http://mybookliveduo/UI/ssh для MBLD).

Подключитесь к SSH-консоли устройства, с помощью любого ssh-клиента, например [PuTTY](https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html). Введите логин и пароль.

> По умолчанию Имя пользователя - `root`, пароль - `welc0me` (0 - цифра).

Если все сделали правильно, появится приглашение к работе.

    MyBookLive:~#

Скачайте и запустите [скрипт](install.sh) автоустановки chroot-среды:

    MyBookLive:~# wget --no-check-certificate https://github.com/FLANKERSPb/MyBookLive/blob/master/chroot/install.sh
    MyBookLive:~# sh ./install.sh

Начнётся установка базового набора файлов дистрибутива **Debian Jessie**, которая может занят от 20 до 40 минут. После чего по желанию будет можно установить медиасервер miniDLNA и/или торрент-клиент Transmission.

После установки можно (опционально) запустить установленные сервисы без перезагрузки устройства.

Обычно большинству новичков нового DLNA-сервера и торрент клиента достаточно. Если вы не хотите вникать в подробности работы chroot-среды, то на этом можно остановиться: и DLNA-сервер, и торрент клиент будут правильно стартовать при включении NAS'а и грациозно завершать работу при выключении/перезагрузке. Можно выйти из SSH-консоли, набрав exit и забыть про неё.

## Использование chroot-среды

Запуск

    MyBookLive:~# /etc/init.d/chroot_debian.sh start

Вход

    MyBookLive:~# chroot /DataVolume/debian

выход 

    (chroot-debian)~# exit
    MyBookLive:~#

Остановка

    MyBookLive:~# /etc/init.d/chroot_debian.sh stop
    

Скрипт установки прописывает всё необходимое для запуска выбранных сервисов в сhroot-среде. Сервисы, которые будут стартовать при включении My Book Live перечислены в файле `/DataVolume/debian/chroot-services.list`, по одному сервису в строчке.

Подсказка: в chroot-services.list перечислены имена файлов из `/DataVolume/debian/etc/init.d`, которые необходимо запустить

Даже если никаких сервисов в chroot-среде пока не запускается, перед входом в неё необходимо выполнить скрипт запуска для монтирования необходимых каталогов:

    

## Вход и выход из работающей chroot-среды

Выполните



Выполнив `ls /` вы поймёте, что уже не в окружении прошивки. Так же изменилось приглашение с `MyBookLive:~#` на `(chroot-debian)~#`. Здесь уже можно без боязни выполнять `apt-get update`, устанавливать, конфигурировать или удалять любые пакеты: перед вами полноценный дистрибутив Debian Stable, который можно использовать практически без ограничений. Из-за того, что всё происходит в изолированной "песочнице", файлам прошивки навредить не выйдет при всём желании. После окончания конфигурирования новых сервисов не забудьте внести их имена в `chroot-services.list`. Для выхода из chroot-среды выполните `exit` и вы вернётесь в привычное окружение прошивки.




## Воостановление автостарта после обновления прошивки
Необходимо вернуть на законное место скрипт запуска chroot-сервисов:

    /DataVolume/debian/chroot_debian.sh install

Удаление chroot-среды

    /etc/init.d/chroot_debian.sh stop
    /etc/init.d/chroot_debian.sh remove

Перегрузите WD My Book Live и удалите все файлы Debian Wheezy

    rm -fr /DataVolume/debian/

